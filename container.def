Bootstrap: docker
From: nvidia/cuda:12.3.1-devel-ubuntu22.04

%setup

%files
requirements.txt requirements.txt

%post

# set timezone to zurich & prevent tzdata to run interactive mode
ln -snf /usr/share/zoneinfo/Europe/Zurich /etc/localtime && echo Europe/Zurich > /etc/timezone

printf "\n\n\n\n\n\n\n\n\n \033[0;41m APT-INSTALL \033[0m \n\n\n\n\n\n\n\n\n"

apt-get update && apt-get install -y \
  locales language-pack-fi language-pack-en \
  ubuntu-dbgsym-keyring \
  fonts-powerline \
  tree \
  wget \
  nano \
  zsh \
  gdb \
  git \
  zip \
  gpac \
  xvfb \
  xclip \
  ffmpeg \
  vmtouch \
  git-lfs \
  python3.11 \
  hdf5-tools \
  imagemagick \
  python3-pip \
  python3.11-dev \
  python3.11-venv

printf "\n\n\n\n\n\n\n\n\n \033[0;41m ZSH-INSTALL \033[0m \n\n\n\n\n\n\n\n\n"

sh -c "$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)"

printf "\n\n\n\n\n\n\n\n\n \033[0;41m PYTHON-INSTALL \033[0m \n\n\n\n\n\n\n\n\n"

python3.11 -m pip install --upgrade \
  pip \
  setuptools

python3.11 -m pip install -r requirements.txt

python3.11 -m pip install \
  tqdm \
  h5py \
  ipdb \
  keras \
  numpy \
  scipy \
  pandas \
  plotly \
  seaborn \
  xgboost \
  ptflops \
  tensorrt \
  torchinfo \
  torchscan \
  matplotlib \
  tensorflow \
  tensorboard \
  scikit-learn \
  scikit-image \
  opencv-python \
  ffmpeg-python \
  albumentations \
  torch-tb-profiler

%environment

export DISPLAY=:1.0
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export LANGUAGE=en_US.UTF-8

%runscript

%startscript

%test

printf "\n\n\n\n\n\n\n\n\n \033[0;41m PYTHON-TEST \033[0m \n\n\n\n\n\n\n\n\n"

TRAINBASE64="aW1wb3J0IG1hdGgKaW1wb3J0IHRvcmNoCmltcG9ydCBudW1weSBhcyBucApmcm9"
TRAINBASE64="${TRAINBASE64}tIHRxZG0gaW1wb3J0IHRxZG0KCgpjbGFzcyBOTih0b3JjaC5ubi5Nb2R1bGUpOgogICAgZGVmIF9"
TRAINBASE64="${TRAINBASE64}faW5pdF9fKHNlbGYsIGlucHV0LCBvdXRwdXQsIGhpZGRlbj0zMiwgbm9"
TRAINBASE64="${TRAINBASE64}ubGluZWFyPXRvcmNoLm5uLlNpTFUpOgogICAgICAgIHN1cGVyKE5OLCBzZWxmKS5fX2luaXRfXygpCgogICAgICAgIHNlbGYuZmVhdHVyZXMgPSB0b3JjaC5ubi5TZXF1ZW50aWFsKAogICAgICAgICAgICB0b3JjaC5ubi5MaW5lYXIoaW5wdXQsIDMyKSwKICAgICAgICAgICAgbm9"
TRAINBASE64="${TRAINBASE64}ubGluZWFyKCksCiAgICAgICAgICAgIHRvcmNoLm5uLkxpbmVhcigzMiwgMzIpLAogICAgICAgICAgICBub25saW5lYXIoKSwKICAgICAgICAgICAgdG9"
TRAINBASE64="${TRAINBASE64}yY2gubm4uTGluZWFyKDMyLCAzMiksCiAgICAgICAgICAgIG5vbmxpbmVhcigpLAogICAgICAgICAgICB0b3JjaC5ubi5MaW5lYXIoMzIsIDMyKSwKICAgICAgICAgICAgbm9"
TRAINBASE64="${TRAINBASE64}ubGluZWFyKCksCiAgICAgICAgICAgIHRvcmNoLm5uLkxpbmVhcigzMiwgaGlkZGVuKSwKICAgICAgICAgICAgbm9"
TRAINBASE64="${TRAINBASE64}ubGluZWFyKCkKICAgICAgICApCgogICAgICAgIHNlbGYuX3lmZWF0dXJlcyA9"
TRAINBASE64="${TRAINBASE64}IHRvcmNoLm5uLlNlcXVlbnRpYWwoCiAgICAgICAgICAgIHRvcmNoLm5uLkxpbmVhcihvdXRwdXQsIDMyKSwKICAgICAgICAgICAgbm9"
TRAINBASE64="${TRAINBASE64}ubGluZWFyKCksCiAgICAgICAgICAgIHRvcmNoLm5uLkxpbmVhcigzMiwgMzIpLAogICAgICAgICAgICBub25saW5lYXIoKSwKICAgICAgICAgICAgdG9"
TRAINBASE64="${TRAINBASE64}yY2gubm4uTGluZWFyKDMyLCAzMiksCiAgICAgICAgICAgIG5vbmxpbmVhcigpLAogICAgICAgICAgICB0b3JjaC5ubi5MaW5lYXIoMzIsIGhpZGRlbiksCiAgICAgICAgICAgIG5vbmxpbmVhcigpCiAgICAgICAgKQoKICAgICAgICBzZWxmLl9"
TRAINBASE64="${TRAINBASE64}lbmVyZ3kgPSB0b3JjaC5ubi5TZXF1ZW50aWFsKAogICAgICAgICAgICB0b3JjaC5ubi5MaW5lYXIoaGlkZGVuICogMiwgMzIpLAogICAgICAgICAgICBub25saW5lYXIoKSwKICAgICAgICAgICAgdG9"
TRAINBASE64="${TRAINBASE64}yY2gubm4uTGluZWFyKDMyLCAzMiksCiAgICAgICAgICAgIG5vbmxpbmVhcigpLAogICAgICAgICAgICB0b3JjaC5ubi5MaW5lYXIoMzIsIDE2KSwKICAgICAgICAgICAgbm9"
TRAINBASE64="${TRAINBASE64}ubGluZWFyKCksCiAgICAgICAgICAgIHRvcmNoLm5uLkxpbmVhcigxNiwgMSkKICAgICAgICApCgogICAgZGVmIGVuZXJneShzZWxmLCBmZWF0dXJlcywgeSk6CiAgICAgICAgY29"
TRAINBASE64="${TRAINBASE64}uY2F0ID0gdG9yY2guY2F0KFtmZWF0dXJlcywgc2VsZi5feWZlYXR1cmVzKHkpXSwgZGltPS0xKQogICAgICAgIHJldHVybiBzZWxmLl9"
TRAINBASE64="${TRAINBASE64}lbmVyZ3koY29uY2F0KQoKICAgIGRlZiBmb3J3YXJkKHNlbGYsIHgsIHkpOgogICAgICAgIHJldHVybiBzZWxmLmVuZXJneShzZWxmLmZlYXR1cmVzKHgpLCB5KQoKCmRlZiBtYWluKCk6CgogICAgIyBIeXBlcnBhcmFtZXRlcnMKCiAgICBlcG9"
TRAINBASE64="${TRAINBASE64}jaHMgPSAxNTAKICAgIG5fc2FtcGxlcyA9IDEyOAogICAgc2FtcGxlX3N0ZXBzID0gMTYKICAgIGJhdGNoX3NpemUgPSA1MTIKICAgIGRhdGFzZXRfc2l6ZSA9"
TRAINBASE64="${TRAINBASE64}IDIwNDgKICAgIGxlYXJuaW5nX3JhdGUgPSAxZS0yCiAgICBkZXZpY2UgPSAnY3B1JwoKICAgICMgRGF0YXNldAoKICAgIGRlZiBmbih4KToKICAgICAgICB5ID0gdG9"
TRAINBASE64="${TRAINBASE64}yY2guemVyb3NfbGlrZSh4KQogICAgICAgIG1hc2sgPSB4IDw9IDAKICAgICAgICBzaWduID0gdG9"
TRAINBASE64="${TRAINBASE64}yY2guc2lnbih0b3JjaC5yYW5kX2xpa2UoeVttYXNrXSkgLSAuNSAtIC40KQogICAgICAgIHlbbWFza10gPSBzaWduICogKHRvcmNoLmNvcyh4W21hc2tdICogMiAqIG1hdGgucGkgKyBtYXRoLnBpKSAqIC4xICsgLjEpCiAgICAgICAgbWFzayA9"
TRAINBASE64="${TRAINBASE64}IHggPiAuNwogICAgICAgIHlbbWFza10gPSAuNSAqICh4W21hc2tdIC0gLjcpCiAgICAgICAgeSArPSB0b3JjaC5yYW5kbl9"
TRAINBASE64="${TRAINBASE64}saWtlKHkpICogLjAxCiAgICAgICAgcmV0dXJuIHkKCiAgICBkZWYgZGF0YV9"
TRAINBASE64="${TRAINBASE64}sb2FkZXIoYnMsIHhzLCB5cyk6CiAgICAgICAgbGVuZ3RoID0geHMuc2l6ZSgwKQogICAgICAgIGZvciBzdGFydCBpbiB0b3JjaC5hcmFuZ2UoMCwgbGVuZ3RoLCBicyk6CiAgICAgICAgICAgIGVuZCA9"
TRAINBASE64="${TRAINBASE64}IG1pbihzdGFydCArIGJzLCBsZW5ndGgpCiAgICAgICAgICAgIHlpZWxkIHhzW3N0YXJ0OmVuZF0sIHlzW3N0YXJ0OmVuZF0KCiAgICB4X3RyYWluID0gMSAtIDIgKiB0b3JjaC5yYW5kKGRhdGFzZXRfc2l6ZSwgMSkKICAgIHhfdGVzdCA9"
TRAINBASE64="${TRAINBASE64}IDEgLSAyICogdG9yY2gucmFuZChkYXRhc2V0X3NpemUsIDEpCiAgICB5X3RyYWluID0gZm4oeF9"
TRAINBASE64="${TRAINBASE64}0cmFpbikKICAgIHlfdGVzdCA9IGZuKHhfdGVzdCkKCiAgICAjIE1vZGVsCgogICAgbW9kZWwgPSBOTigxLCAxLCBoaWRkZW49"
TRAINBASE64="${TRAINBASE64}MTYpLnRvKGRldmljZSkudHJhaW4oKQoKICAgICMgTG9zcywgTWV0cmljcyBhbmQgT3B0aW1pemVyCgogICAgb3B0aW1pemVyID0gdG9"
TRAINBASE64="${TRAINBASE64}yY2gub3B0aW0uQWRhbShtb2RlbC5wYXJhbWV0ZXJzKCksIGxyPWxlYXJuaW5nX3JhdGUpCgogICAgIyBUcmFpbmluZwoKICAgIGVwb2Noc19"
TRAINBASE64="${TRAINBASE64}sb2dnZXIgPSB0cWRtKHJhbmdlKDEsIGVwb2NocyArIDEpLCBkZXNjPSdlcG9"
TRAINBASE64="${TRAINBASE64}jaCcpCiAgICBmb3IgZXBvY2ggaW4gZXBvY2hzX2xvZ2dlcjoKICAgICAgICBydW5uaW5nX2xvc3MgPSBbXQogICAgICAgIGZvciB4LCB5IGluIGRhdGFfbG9"
TRAINBASE64="${TRAINBASE64}hZGVyKGJhdGNoX3NpemUsIHhfdHJhaW4sIHlfdHJhaW4pOgogICAgICAgICAgICB4LCB5ID0geC50byhkZXZpY2UpLCB5LnRvKGRldmljZSkKCiAgICAgICAgICAgIGZlYXR1cmVzID0gbW9"
TRAINBASE64="${TRAINBASE64}kZWwuZmVhdHVyZXMoeCkKICAgICAgICAgICAgdHJ1ZV9"
TRAINBASE64="${TRAINBASE64}lbmVyZ3kgPSBtb2RlbC5lbmVyZ3koZmVhdHVyZXMsIHkpCgogICAgICAgICAgICB5ID0geS5yZXBlYXRfaW50ZXJsZWF2ZShuX3NhbXBsZXMsIGRpbT0wKQogICAgICAgICAgICBmZWF0dXJlcyA9"
TRAINBASE64="${TRAINBASE64}IGZlYXR1cmVzLnJlcGVhdF9pbnRlcmxlYXZlKG5fc2FtcGxlcywgZGltPTApCgogICAgICAgICAgICBub2lzZSA9"
TRAINBASE64="${TRAINBASE64}IHRvcmNoLnNpZ24odG9yY2gucmFuZCgKICAgICAgICAgICAgICAgICh4LnNpemUoMCkgKiBuX3NhbXBsZXMsIDEpLCBkZXZpY2U9"
TRAINBASE64="${TRAINBASE64}eC5kZXZpY2UpIC0gLjUpCiAgICAgICAgICAgIG5vaXNlICo9"
TRAINBASE64="${TRAINBASE64}IHRvcmNoLnJhbmRfbGlrZShub2lzZSkgKiAuMSArIC4wNQogICAgICAgICAgICBzYW1wbGVzID0geSArIG5vaXNlCgogICAgICAgICAgICBmYWtlX2VuZXJneSA9"
TRAINBASE64="${TRAINBASE64}IG1vZGVsLmVuZXJneShmZWF0dXJlcywgc2FtcGxlcykKICAgICAgICAgICAgZmFrZV9"
TRAINBASE64="${TRAINBASE64}lbmVyZ3kgPSBmYWtlX2VuZXJneS52aWV3KC0xLCAxLCBuX3NhbXBsZXMpLm1lYW4oZGltPS0xKQoKICAgICAgICAgICAgbG9"
TRAINBASE64="${TRAINBASE64}zcyA9IChmYWtlX2VuZXJneSAtIHRydWVfZW5lcmd5ICsKICAgICAgICAgICAgICAgICAgICAuMSAqICh0cnVlX2VuZXJneSAqKiAyICsgZmFrZV9"
TRAINBASE64="${TRAINBASE64}lbmVyZ3kgKiogMikpLm1lYW4oKQoKICAgICAgICAgICAgb3B0aW1pemVyLnplcm9"
TRAINBASE64="${TRAINBASE64}fZ3JhZCgpCiAgICAgICAgICAgIGxvc3MuYmFja3dhcmQoKQogICAgICAgICAgICB0b3JjaC5ubi51dGlscy5jbGlwX2dyYWRfbm9"
TRAINBASE64="${TRAINBASE64}ybV8obW9kZWwucGFyYW1ldGVycygpLCAxZS0yKQogICAgICAgICAgICBvcHRpbWl6ZXIuc3RlcCgpCgogICAgICAgICAgICBydW5uaW5nX2xvc3MuYXBwZW5kKGxvc3MuaXRlbSgpKQoKICAgICAgICBsb2dfc3RyID0gZidMOiB7bnAubWVhbihydW5uaW5nX2xvc3MpOi40Zn0nCiAgICAgICAgZXBvY2hzX2xvZ2dlci5zZXRfcG9"
TRAINBASE64="${TRAINBASE64}zdGZpeF9zdHIobG9nX3N0cikKCiAgICAjIFBsb3QKCiAgICBtb2RlbCA9IG1vZGVsLmV2YWwoKQogICAgYmlucyA9"
TRAINBASE64="${TRAINBASE64}IFswLjEsIC4yNSwgLjUwLCAuNzVdCiAgICBzaGFkZXMgPSBbJyAgJywgJ1x1MjU5MVx1MjU5MScsICdcdTI1OTJcdTI1OTInLCAnXHUyNTkzXHUyNTkzJywgJ1x1MjU4OFx1MjU4OCddCgogICAgbGVuZ3RoID0gNDgKICAgIHh4ID0gdG9"
TRAINBASE64="${TRAINBASE64}yY2gubGluc3BhY2UoLTEuNSwgMS41LCBsZW5ndGgpCiAgICB5eSA9"
TRAINBASE64="${TRAINBASE64}IHRvcmNoLmxpbnNwYWNlKC0uNSwgLjUsIGxlbmd0aCkKICAgIHh4LCB5eSA9IHRvcmNoLm1lc2hncmlkKHh4LCB5eSkKICAgIHp6ID0gbW9"
TRAINBASE64="${TRAINBASE64}kZWwoeHgucmVzaGFwZSgtMSwgMSksIHl5LnJlc2hhcGUoLTEsIDEpKS52aWV3KCp4eC5zaXplKCkpLmRldGFjaCgpLm51bXB5KCkKICAgIHp6ID0gLXp6IC8genoubWF4KCkKICAgIHp6ID0gKHp6IC0genoubWluKCkpIC8gKHp6Lm1heCgpIC0genoubWluKCkpCiAgICB6eiA9"
TRAINBASE64="${TRAINBASE64}IG5wLmRpZ2l0aXplKHp6LCBiaW5zKS5hc3R5cGUoaW50KQoKICAgIGltZyA9"
TRAINBASE64="${TRAINBASE64}IG5wLmZ1bGwoenouc2hhcGUsICcjIycpCiAgICBmb3IgaSwgc2hhZGUgaW4gZW51bWVyYXRlKHNoYWRlcyk6CiAgICAgICAgaW1nW3p6ID09"
TRAINBASE64="${TRAINBASE64}IGldID0gc2hhZGUKICAgIGltZyA9IGltZy50b2xpc3QoKQoKICAgIHByaW50KCkKICAgIGZvciByb3cgaW4gaW1nOgogICAgICAgIHByaW50KCcgJyArICcnLmpvaW4ocm9"
TRAINBASE64="${TRAINBASE64}3KSkKICAgIHByaW50KCkKCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgbWFpbigpCg=="
python3.8 -c "`echo $TRAINBASE64 | base64 -d`"

%labels

%help
Ubuntu 18.04 + Python 3.8 + PyTorch 2.0.0 + CUDA 11.8

